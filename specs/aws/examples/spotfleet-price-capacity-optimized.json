{
  "IamFleetRole": "{{ iam_fleet_role }}",
  "AllocationStrategy": "price-capacity-optimized",
  "TargetCapacity": "{{ requested_count }}",
  "LaunchSpecifications": [{
    "LaunchTemplate": {
      "LaunchTemplateId": "{{ launch_template_id }}",
      "Version": "{{ launch_template_version | default('$Latest') }}"
    },
    "Overrides": [
      {"InstanceType": "m5.large", "SubnetId": "{{ subnet_ids[0] }}"},
      {"InstanceType": "m5.xlarge", "SubnetId": "{{ subnet_ids[1] if subnet_ids|length > 1 else subnet_ids[0] }}"},
      {"InstanceType": "c5.large", "SubnetId": "{{ subnet_ids[0] }}"},
      {"InstanceType": "c5.xlarge", "SubnetId": "{{ subnet_ids[1] if subnet_ids|length > 1 else subnet_ids[0] }}"}
    ]
  }],
  "Type": "maintain",
  "ReplaceUnhealthyInstances": true,
  "InstanceInterruptionBehavior": "terminate",
  "TagSpecifications": [{
    "ResourceType": "spot-fleet-request",
    "Tags": [
      {"Key": "Name", "Value": "price-optimized-spotfleet-{{ request_id }}"},
      {"Key": "RequestId", "Value": "{{ request_id }}"},
      {"Key": "TemplateId", "Value": "{{ template_id }}"},
      {"Key": "CreatedBy", "Value": "{{ package_name }}"},
      {"Key": "AllocationStrategy", "Value": "price-capacity-optimized"}
    ]
  }]
}
