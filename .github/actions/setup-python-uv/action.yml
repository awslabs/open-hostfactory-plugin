name: 'Setup Python and UV'
description: 'Setup Python, UV, generate pyproject.toml, and install dependencies'
inputs:
  python-version:
    description: 'Python version to setup'
    required: true
  install-deps:
    description: 'Whether to install dependencies'
    required: false
    default: 'true'
  cache-key-suffix:
    description: 'Additional cache key suffix'
    required: false
    default: ''
runs:
  using: 'composite'
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-version }}

    - name: Install UV
      uses: astral-sh/setup-uv@v6
      with:
        enable-cache: true
        cache-dependency-glob: "pyproject.toml.template"
        cache-suffix: ${{ inputs.cache-key-suffix }}

    - name: Generate pyproject.toml
      shell: bash
      run: make generate-pyproject

    - name: Install dependencies
      if: inputs.install-deps == 'true'
      shell: bash
      run: make ci-install
