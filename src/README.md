# Source Code Overview

This directory contains the main source code for the Open Host Factory Plugin, implementing a clean Domain-Driven Design (DDD) architecture with perfect separation of concerns.

The codebase consists of 250+ Python files organized across multiple architectural layers, demonstrating enterprise-grade software design principles.

## Architecture Overview

The codebase follows Clean Architecture principles with clear dependency direction:
```
Domain ‚Üê Application ‚Üê Infrastructure ‚Üê Providers
```

## Package Structure

### üìÅ `domain/` - Domain Layer (Pure Business Logic)
The heart of the application containing pure business logic with zero external dependencies.

**File Count**: 33 files organized across bounded contexts

**Key Components:**
- **Bounded Contexts**: Template, Machine, Request
- **Aggregates**: Core business entities with behavior
- **Value Objects**: Immutable domain concepts
- **Domain Events**: Business event notifications
- **Repository Interfaces**: Data access contracts

**Architecture Principles:**
- Zero infrastructure dependencies
- Rich domain models with encapsulated business logic
- Provider-agnostic design
- Event-driven architecture

### üìÅ `application/` - Application Layer (Use Cases)
Orchestrates domain objects and coordinates business workflows.

**File Count**: 41 files implementing comprehensive use cases

**Key Components:**
- **CQRS Implementation**: Commands for writes, Queries for reads
- **Command/Query Handlers**: Business use case implementations
- **Application Services**: Workflow orchestration
- **DTOs**: Data transfer objects for layer boundaries
- **Event Handlers**: Cross-cutting concern handlers

**Patterns Used:**
- **CQRS**: For complex business operations
- **Service Pattern**: For simple CRUD operations
- **Event-Driven**: For decoupled communication

### üìÅ `infrastructure/` - Infrastructure Layer (Technical Concerns)
Provides technical implementations of domain interfaces.

**File Count**: 102 files providing comprehensive infrastructure support

**Key Components:**
- **Persistence**: Repository implementations with multiple storage strategies
- **Events**: Event sourcing and publishing infrastructure
- **Dependency Injection**: IoC container and service registration
- **Resilience**: Retry mechanisms and error handling
- **Utilities**: Common technical utilities

**Features:**
- Multiple storage strategies (JSON, SQL, DynamoDB)
- Comprehensive event system with 50+ handlers
- Production-ready error handling and logging

### üìÅ `providers/` - Provider Layer (Cloud Extensions)
Cloud-specific implementations extending the core system.

**File Count**: 48 files with complete AWS implementation

**Current Providers:**
- **AWS**: Complete implementation with EC2, Spot Fleet, ASG support

**Provider-Agnostic Design:**
- Domain layer uses generic `provider_config`
- Clean extension points for new providers
- Ready for multi-cloud expansion (Provider1, Provider2, etc.)

### üìÅ `api/` - API Layer (External Interface)
Host Factory compatible API implementation.

**Key Components:**
- **Handlers**: API endpoint implementations
- **Models**: Request/response data models
- **Validation**: Input validation and sanitization

**Supported Operations:**
- `getAvailableTemplates`: Get VM templates
- `requestMachines`: Request new machines
- `getRequestStatus`: Check request status
- `requestReturnMachines`: Return machines
- `getReturnRequests`: Get return requests

### üìÅ `config/` - Configuration Management
Unified configuration system with validation and type safety.

**Features:**
- Type-safe configuration with dataclasses
- Multiple configuration sources (files, environment variables)
- Legacy configuration support
- Configuration validation and schema enforcement

### üìÅ `monitoring/` - Monitoring and Observability
Health checks, metrics, and monitoring capabilities.

**Components:**
- Health check system
- Metrics collection
- Performance monitoring

## Key Architectural Achievements

### ‚úÖ Perfect DDD Implementation
- **Bounded Contexts**: Clean separation between Template, Machine, Request
- **Shared Kernel**: Common domain primitives in `base/`
- **Rich Domain Models**: Business logic encapsulated in aggregates
- **Ubiquitous Language**: Consistent terminology throughout

### ‚úÖ SOLID Principles Compliance
- **Single Responsibility**: Each class has one reason to change
- **Open/Closed**: Open for extension, closed for modification
- **Liskov Substitution**: Subtypes are substitutable for base types
- **Interface Segregation**: Clients depend only on interfaces they use
- **Dependency Inversion**: High-level modules don't depend on low-level modules

### ‚úÖ Event-Driven Architecture
- **Domain Events**: Generated by aggregates for business state changes
- **Event Sourcing**: Complete audit trail of all changes
- **Event Handlers**: 50+ handlers for cross-cutting concerns
- **Decoupled Communication**: Components communicate through events

### ‚úÖ Provider-Agnostic Design
- **Zero Cloud Dependencies**: Domain layer is completely cloud-agnostic
- **Clean Extension Points**: Easy to add new cloud providers
- **Standardized Interfaces**: Consistent provider abstraction

## Development Guidelines

### Adding New Features
1. **Start with Domain**: Define business concepts in domain layer
2. **Add Use Cases**: Implement in application layer
3. **Provide Infrastructure**: Add technical implementations
4. **Extend Providers**: Add cloud-specific features if needed

### Testing Strategy
- **Unit Tests**: Test domain logic in isolation
- **Integration Tests**: Test layer interactions
- **End-to-End Tests**: Test complete workflows

### Code Quality
- **Type Safety**: Full type hints throughout
- **Documentation**: Comprehensive docstrings
- **Error Handling**: Proper exception handling at all layers
- **Logging**: Structured logging for observability

## Dependencies

### Core Dependencies
- **Pydantic**: Data validation and serialization
- **Boto3**: AWS SDK (provider-specific)
- **Typing**: Type safety and hints

### Development Dependencies
- **Pytest**: Testing framework
- **MyPy**: Static type checking
- **Black**: Code formatting
- **Pylint**: Code quality analysis

## Getting Started

1. **Understand the Domain**: Start with `domain/` to understand business concepts
2. **Explore Use Cases**: Check `application/` for business workflows
3. **Review Infrastructure**: Examine `infrastructure/` for technical implementations
4. **Study Providers**: Look at `providers/aws/` for cloud integration examples

## Architecture Diagrams

See the `/diagrams` directory for visual representations of:
- System architecture
- Request flows
- Component interactions
- AWS handler inheritance

---

This source code represents a production-ready, enterprise-grade implementation of Domain-Driven Design principles with excellent separation of concerns and extensibility.
