{
  "SpotFleetRequestConfig": {
    "IamFleetRole": "{{ fleet_role }}",
    "AllocationStrategy": "{{ allocation_strategy }}",
    "TargetCapacity": {{ target_capacity }},
    "SpotPrice": "{{ spot_price }}",
    "LaunchSpecifications": [
      {
        "LaunchTemplate": {
          "LaunchTemplateId": "{{ launch_template_id }}",
          "Version": "{{ launch_template_version }}"
        },
        "ImageId": "{{ base_launch_spec.image_id }}",
        "InstanceType": "{{ instance_overrides[0].instance_type }}",
        "WeightedCapacity": {{ instance_overrides[0].weighted_capacity }}{% if base_launch_spec.security_groups %},
        "SecurityGroups": [
          {% for sg in base_launch_spec.security_groups %}
          {"GroupId": "{{ sg }}"}{% if not loop.last %},{% endif %}
          {% endfor %}
        ]{% endif %}
      }
    ],
    "InstanceInterruptionBehavior": "{{ instance_interruption_behavior }}",
    "ReplaceUnhealthyInstances": {{ replace_unhealthy_instances | tojson }},
    "TagSpecifications": [
      {
        "ResourceType": "spot-fleet-request",
        "Tags": [
          {"Key": "Name", "Value": "{{ fleet_name }}"},
          {% for tag in base_tags %}
          {"Key": "{{ tag.key }}", "Value": "{{ tag.value }}"}{% if not loop.last or has_custom_tags %},{% endif %}
          {% endfor %}{% if has_custom_tags %},
          {% for tag in custom_tags %}
          {"Key": "{{ tag.key }}", "Value": "{{ tag.value }}"}{% if not loop.last %},{% endif %}
          {% endfor %}{% endif %}
        ]
      }
    ]
  }
}
